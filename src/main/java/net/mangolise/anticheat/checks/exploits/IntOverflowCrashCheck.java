package net.mangolise.anticheat.checks.exploits;

import net.mangolise.anticheat.ACCheck;
import net.minestom.server.MinecraftServer;
import net.minestom.server.event.player.PlayerMoveEvent;

public class IntOverflowCrashCheck extends ACCheck {

    public IntOverflowCrashCheck() {
        super("IntOverflowCrash");
    }

    @Override
    public void register() {
        MinecraftServer.getGlobalEventHandler().addListener(PlayerMoveEvent.class, e -> {
            double x = Math.abs(e.getNewPosition().x());
            double y = Math.abs(e.getNewPosition().y());
            double z = Math.abs(e.getNewPosition().z());
            if (isInvalid(x) || isInvalid(y) || isInvalid(z)) {
                e.setCancelled(true);
                flag(e.getPlayer(), 1f);  // This is 100% an attempt to crash the server
            }
        });
    }

    private boolean isInvalid(double val) {
        return val >= Integer.MAX_VALUE || val <= Integer.MIN_VALUE;
    }
}
